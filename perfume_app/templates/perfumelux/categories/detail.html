{% extends 'perfumelux/base.html' %}
{% load static %}

{% block extra_css %}
<style>
    .category-header {
        position: relative;
        overflow: hidden;
        border-radius: 20px;
        margin-bottom: 40px;
        background: linear-gradient(135deg,
            rgba(138, 79, 255, 0.1) 0%,
            rgba(209, 217, 230, 0.3) 50%,
            rgba(230, 233, 239, 0.7) 100%);
    }

    .category-icon {
        font-size: 100px;
        margin-bottom: 20px;
        color: var(--accent-color);
    }

    .breadcrumb {
        display: flex;
        align-items: center;
        gap: 10px;
        margin-bottom: 30px;
        padding: 15px 0;
    }

    .breadcrumb a {
        color: var(--accent-color);
        text-decoration: none;
        display: flex;
        align-items: center;
        gap: 5px;
    }

    .breadcrumb span {
        color: var(--text-muted);
    }

    .sort-filter-container {
        display: flex;
        justify-content: space-between;
        align-items: center;
        flex-wrap: wrap;
        gap: 20px;
        margin-bottom: 30px;
        padding: 20px;
        border-radius: 15px;
    }

    .sort-options {
        display: flex;
        align-items: center;
        gap: 15px;
        flex-wrap: wrap;
    }

    .sort-btn {
        padding: 10px 20px;
        border: none;
        border-radius: 10px;
        background: var(--primary-color);
        color: var(--text-color);
        cursor: pointer;
        transition: all 0.3s ease;
        display: flex;
        align-items: center;
        gap: 8px;
    }

    .sort-btn.active {
        background: var(--accent-color);
        color: white;
        box-shadow: 0 4px 15px rgba(138, 79, 255, 0.3);
    }

    .sort-btn:hover:not(.active) {
        box-shadow: inset 3px 3px 6px var(--shadow-dark),
                    inset -3px -3px 6px var(--shadow-light);
    }

    .products-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
        gap: 30px;
        margin-bottom: 40px;
    }

    .pagination {
        display: flex;
        justify-content: center;
        gap: 10px;
        margin-top: 40px;
    }

    .page-btn {
        padding: 12px 18px;
        border: none;
        border-radius: 10px;
        background: var(--primary-color);
        color: var(--text-color);
        cursor: pointer;
        transition: all 0.3s ease;
        text-decoration: none;
        display: flex;
        align-items: center;
        justify-content: center;
        min-width: 45px;
    }

    .page-btn.active {
        background: var(--accent-color);
        color: white;
        box-shadow: 0 4px 15px rgba(138, 79, 255, 0.3);
    }

    .page-btn:hover:not(.active) {
        box-shadow: inset 3px 3px 6px var(--shadow-dark),
                    inset -3px -3px 6px var(--shadow-light);
    }

    .empty-state {
        text-align: center;
        padding: 60px 30px;
        border-radius: 20px;
    }

    .empty-icon {
        font-size: 80px;
        margin-bottom: 20px;
        color: var(--text-muted);
    }

    .category-description {
        line-height: 1.8;
        color: var(--text-color);
        font-size: 1.1rem;
    }

    @media (max-width: 768px) {
        .sort-filter-container {
            flex-direction: column;
            align-items: stretch;
        }

        .sort-options {
            justify-content: center;
        }

        .category-icon {
            font-size: 70px;
        }

        .products-grid {
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 20px;
        }
    }
</style>
{% endblock %}

{% block content %}
<div class="container">
    <!-- Breadcrumb -->
    <div class="breadcrumb">
        <a href="{% url 'home' %}">
            <i class="fas fa-home"></i> Home
        </a>
        <i class="fas fa-chevron-right" style="color: var(--text-muted); font-size: 12px;"></i>
        <a href="{% url 'category_list' %}">
            <i class="fas fa-tags"></i> Categories
        </a>
        <i class="fas fa-chevron-right" style="color: var(--text-muted); font-size: 12px;"></i>
        <span>{{ category.name }}</span>
    </div>

    <!-- Category Header -->
    <div class="category-header neu-outset" style="padding: 50px; text-align: center;">
        <div class="category-icon">
            {% if category.name == "Men" %}üëî
            {% elif category.name == "Women" %}üëó
            {% elif category.name == "Unisex" %}üë•
            {% elif category.name == "Floral" %}üåπ
            {% elif category.name == "Woody" %}üå≤
            {% elif category.name == "Citrus" %}üçã
            {% elif category.name == "Oriental" %}üè∫
            {% elif category.name == "Fresh" %}üíß
            {% else %}üå∏
            {% endif %}
        </div>
        <h1 style="margin-bottom: 15px; font-size: 2.5rem;">{{ category.name }} Fragrances</h1>
        <p style="font-size: 1.2rem; color: var(--text-muted); max-width: 700px; margin: 0 auto; line-height: 1.6;">
            {{ category.description|default:"Discover our exquisite collection of "|add:category.name|add:" fragrances crafted for the modern connoisseur." }}
        </p>
        <div style="margin-top: 25px; display: flex; justify-content: center; gap: 15px; flex-wrap: wrap;">
            <div class="neu-outset" style="padding: 12px 20px; border-radius: 25px; display: flex; align-items: center; gap: 8px;">
                <i class="fas fa-cube"></i>
                <span>{{ page_obj.paginator.count }} Products</span>
            </div>
            <div class="neu-outset" style="padding: 12px 20px; border-radius: 25px; display: flex; align-items: center; gap: 8px;">
                <i class="fas fa-star"></i>
                <span>Premium Quality</span>
            </div>
        </div>
    </div>

    <!-- Sort and Filter Section -->
    <div class="sort-filter-container neu-outset">
        <div style="display: flex; align-items: center; gap: 15px;">
            <i class="fas fa-filter" style="color: var(--accent-color);"></i>
            <span style="font-weight: 600;">Filter Products:</span>
        </div>

        <div class="sort-options">
            <button class="sort-btn {% if request.GET.sort == 'name' or not request.GET.sort %}active{% endif %}"
                    onclick="sortProducts('name')">
                <i class="fas fa-font"></i> Name
            </button>
            <button class="sort-btn {% if request.GET.sort == 'price_low' %}active{% endif %}"
                    onclick="sortProducts('price_low')">
                <i class="fas fa-arrow-up"></i> Price: Low to High
            </button>
            <button class="sort-btn {% if request.GET.sort == 'price_high' %}active{% endif %}"
                    onclick="sortProducts('price_high')">
                <i class="fas fa-arrow-down"></i> Price: High to Low
            </button>
            <button class="sort-btn {% if request.GET.sort == 'newest' %}active{% endif %}"
                    onclick="sortProducts('newest')">
                <i class="fas fa-calendar"></i> Newest
            </button>
            <button class="sort-btn {% if request.GET.sort == 'rating' %}active{% endif %}"
                    onclick="sortProducts('rating')">
                <i class="fas fa-star"></i> Rating
            </button>
        </div>
    </div>

    <!-- Products Grid -->
    {% if page_obj %}
    <div class="products-grid">
        {% for product in page_obj %}
        {% include 'perfumelux/includes/product_card.html' with product=product %}
        {% endfor %}
    </div>

    <!-- Pagination -->
    <div class="pagination">
        {% if page_obj.has_previous %}
        <a href="?page={{ page_obj.previous_page_number }}{% if request.GET.sort %}&sort={{ request.GET.sort }}{% endif %}{% if request.GET.search %}&search={{ request.GET.search }}{% endif %}"
           class="page-btn" aria-label="Previous page">
            <i class="fas fa-chevron-left"></i>
        </a>
        {% endif %}

        {% if page_obj.paginator.num_pages > 1 %}
        {% if page_obj.number > 3 %}
        <a href="?page=1{% if request.GET.sort %}&sort={{ request.GET.sort }}{% endif %}{% if request.GET.search %}&search={{ request.GET.search }}{% endif %}"
           class="page-btn" aria-label="Page 1">1</a>
        {% if page_obj.number > 4 %}
        <span class="page-btn page-ellipsis">...</span>
        {% endif %}
        {% endif %}

        {% for num in page_obj.paginator.page_range %}
        {% if num >= page_obj.number|add:'-2' and num <= page_obj.number|add:'2' %}
        {% if page_obj.number == num %}
        <span class="page-btn active" aria-current="page" aria-label="Current page {{ num }}">{{ num }}</span>
        {% else %}
        <a href="?page={{ num }}{% if request.GET.sort %}&sort={{ request.GET.sort }}{% endif %}{% if request.GET.search %}&search={{ request.GET.search }}{% endif %}"
           class="page-btn" aria-label="Page {{ num }}">{{ num }}</a>
        {% endif %}
        {% endif %}
        {% endfor %}

        {% if page_obj.number < page_obj.paginator.num_pages|add:'-2' %}
        {% if page_obj.number < page_obj.paginator.num_pages|add:'-3' %}
        <span class="page-btn page-ellipsis">...</span>
        {% endif %}
        <a href="?page={{ page_obj.paginator.num_pages }}{% if request.GET.sort %}&sort={{ request.GET.sort }}{% endif %}{% if request.GET.search %}&search={{ request.GET.search }}{% endif %}"
           class="page-btn" aria-label="Page {{ page_obj.paginator.num_pages }}">{{ page_obj.paginator.num_pages }}</a>
        {% endif %}
        {% endif %}

        {% if page_obj.has_next %}
        <a href="?page={{ page_obj.next_page_number }}{% if request.GET.sort %}&sort={{ request.GET.sort }}{% endif %}{% if request.GET.search %}&search={{ request.GET.search }}{% endif %}"
           class="page-btn" aria-label="Next page">
            <i class="fas fa-chevron-right"></i>
        </a>
        {% endif %}
    </div>

    <!-- Page Info -->
    <div class="page-info" style="text-align: center; margin-top: 20px; color: var(--text-muted);">
        <p>Showing {{ page_obj.start_index }} - {{ page_obj.end_index }} of {{ page_obj.paginator.count }} products</p>
    </div>

    {% else %}
    <!-- Empty State -->
    <div class="empty-state neu-outset">
        <div class="empty-icon">üîç</div>
        <h3 style="margin-bottom: 15px; color: var(--text-color);">No products in this category yet</h3>
        <p style="color: var(--text-muted); margin-bottom: 30px; max-width: 400px; margin-left: auto; margin-right: auto;">
            We're constantly updating our collection. Check back soon for new arrivals in {{ category.name }} fragrances.
        </p>
        <div style="display: flex; gap: 15px; justify-content: center; flex-wrap: wrap;">
            <a href="{% url 'category_list' %}" class="btn-primary" style="text-decoration: none;">
                <i class="fas fa-tags"></i> Browse Other Categories
            </a>
            <a href="{% url 'product_list' %}" class="btn-neu" style="text-decoration: none;">
                <i class="fas fa-store"></i> View All Products
            </a>
        </div>
    </div>
    {% endif %}

    <!-- Category Description -->
    {% if category.long_description %}
    <div class="neu-outset" style="padding: 40px; border-radius: 20px; margin-top: 50px;">
        <h2 style="margin-bottom: 25px; color: var(--accent-color); display: flex; align-items: center; gap: 15px;">
            <i class="fas fa-info-circle"></i>
            About {{ category.name }} Fragrances
        </h2>
        <div class="category-description">
            {{ category.long_description|linebreaks }}
        </div>
    </div>
    {% endif %}
</div>

<script>
    function sortProducts(sortValue) {
        const url = new URL(window.location.href);
        url.searchParams.set('sort', sortValue);
        // Reset to first page when sorting
        url.searchParams.set('page', '1');
        window.location.href = url.toString();
    }

    // Highlight current sort option on page load
    document.addEventListener('DOMContentLoaded', function() {
        const currentSort = new URLSearchParams(window.location.search).get('sort') || 'name';
        document.querySelectorAll('.sort-btn').forEach(btn => {
            if (btn.onclick.toString().includes(`'${currentSort}'`)) {
                btn.classList.add('active');
            }
        });
    });
</script>
{% endblock %}
